# Debichыы - Vault Main

1) Проверьте, что у Вас установлен докер, а также openssl. В случае проблемы выполнения кода, сравните попробуйте полнсотью повторить эти версии

```bash
sergeyshkviro@sergeyshkviro-MS-7D48:~/Документы/vault_hack/dvault-all$ openssl version && docker --version
OpenSSL 3.0.2 15 Mar 2022 (Library: OpenSSL 3.0.2 15 Mar 2022)
Docker version 26.1.4, build 5650f9b
```

2) Проверьте, что у файла `./hello.sh` имеется флаг +x и выполните:

```bash
./hello.sh
```

Данная команда создаст необходимые сертификаты, а также запустит контейнеры. После окончания работы скрипта все соеденения с БД будут по SSL соеденению. Создастся контейнер в бэкендом `handle_vault`.


В логах Вы сможете наблюдать:


```
Создание директории cert_postgresql...
Генерация ключа и сертификата CA для PostgreSQL...
.+......+..+............+...+.+..+...+............+.........+......+...+....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.....+...+....+.....+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+......+............+..+.+...........+.+........+......+......+.........+.............+.....+.+...........+.........+.......+...+..+....+...+..+.+..+..................+....+......+.........+...+...............+..+.+..............+.........+.......+.....+....+......+..+.+......+.....+......+............+......+....+......+..+............+...+.......+......+..+..........+..+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
.................+..+...+.......+........+.+.....+.+........+......+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+......+.........+..+...+......+.......+..+......+....+..+.........+.+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+........+.............+..+.......+.....+....+...........+.+...+......+...+............+...........+............+...+.........+.........+.........+............+.+..+............+.+........+....+...+.....+...+..........+.....+......+...+............+......+....+......+...+.....+....+.....+.+.....+.+...........+.........+..........+....................+.+...+..+.......+........+....+......+........+....+............+........+.+.....................+.........+..+...+....+..+.............+..+...+..........+...+..+......+.+.........+...........+......+.......+..+.+........+......+....+............+..+.......+...+............+......+.........+........+...............+.+.....+.+.....+.........+.+...+..+......+............+.+......+.....+...+.......+.......................+.+...........+.+..+......+.+................................................+..+...+......+....+......+..+...+.......+...............+...+..+.......+..+.+..+...+....+......+........+....+...+............+......+......+...........+...+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Генерация ключа и сертификата для PostgreSQL сервера...
.+.+.....+.........+......+...+...+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+...........+.+.....+...+....+.....+..........+..+.+............+..+.+...+..+....+........+.+..............+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
..+....+.....+.......+...+.....+.+......+...+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+...........+...+.......+.....+....+...............+.........+...........+.+...............+..+..........+..+.+..+......+...................+........+.......+..+....+..+....+......+...+..+...+......+.+........+.+......+.....+..........+..+..........+...+........+......+....+.........+.....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Certificate request self-signature ok
subject=CN = postgresql-server
Генерация ключа и сертификата для PostgreSQL клиента...
........+.+.....+.+...+.....+.+.....+......+......+.......+...........+.+...+...+.....+...+......+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+.........+...+...+.......+..+......+.........+.+......+....................+....+..+.........+...+..........+............+.........+......+........+.......+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+.+...+.....+...+....+.........+.........+...+.....+.........+.....................+....+.....+...+................+..+.........+.+..+...+...+......+....+.........+.................+....+............+........+......+...............+.+..+...+....+...........+.......+..+.+...+............+.........+........+......+............+...+....+...........+.......+..+......+....+...+..+..........+......+...........+....+..+....+.........+......+........+.+...........+...+.+.....+.+.....+.........+....+...+...............+............+..+......+.......+.....+.+.....+.........+.......+......+........+................+.....+...+......+.+...+.....................+......+..............+.+......+..+.+.....+......+.+........+......+.+...+..+....+.....+...+......+....+..+.............+..+....+..+....+...........+....+......+..+...+....+...+.....+............+...+......+.........+...+...............+.......+.....+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
..+...+..+....+...+...+...+.....+..........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+......+.........+...+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+.........+......+...+..+....+.....+......+....+.....+.+...+.....+...................+......+.........+........+....+.....+.+..+.............+..+...+.........+...+......+....+......+.....+......+...+...+.......+............+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Certificate request self-signature ok
subject=CN = postgresql-client
Изменение прав на сертификаты PostgreSQL...
Создание директории cert_redis...
Генерация ключа и сертификата CA для Redis...
.........+......+...+..+......+.............+..+..........+.........+...+......+.........+...+...+.........+..+.+..+......+.+........+...+...+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+.+........+...+...+.+......+.....+...+.+...+...+.....+..........+.....+.........+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+...+...+.+.....+....+..+.......+............+........+.+..+..........+..+............+.+...+............+..+.+..+..........+..............+....+...........+.............+......+.....+....+......+..+.......+............+.....+......+....+...........+....+.........+..+.........+.+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
.+........+....+...+.........+........................+......+.....+...+............+...+...+....+...+..+.+..+..........+........+...+..........+..+.......+..+......+...+.......+.................+......+......+...+.+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+...+.........+..........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+........+...+.+........+............+.+.................+...+....+...............+...........+...+............+.......+..................+........+......+.+..+.+.....+......+.........+......+.........+............+..........+..............+.............+...............+...+..................+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Генерация ключа и сертификата для Redis сервера...
..........+.+.....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.+...+..+......+...................+.....+...+...+...+....+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+............+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
....+...+...+............+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+..+..........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+.......+...+......+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Certificate request self-signature ok
subject=CN = redis-server
Генерация ключа и сертификата для Redis клиента...
.+....................+.+......+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+..+....+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......................+............+....+...+......+..+...............+....+...+......+...........+.+..+.+.........+..+...+.......+...+..+.........+.......+..+..........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
.+.+...+..+......+........................+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+....+........+.+......+...+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+..+......+....+.................+.....................+....+...+......+..+....+........+......+.+.........+.....+......+...+...+.......+...+...+.....+....+...............+..+....+.....+....+.....+..........+..+...................+..............+............+...............+....+..+.........+....+......+...+...+........................+........+...+...+....+.......................+...+....+...+...+...........+....+......+......+.....+.........+.+..+......+.+........+.+..+...+.+........+.......+...+..+................+.........+..............+....+........+...+....+.....+.+..............+.............+..................+..+...................+...+...........+.+........+......+....+............+......+..+.+...........+.+.....+...............+...............+.......+......+.........+.....+............+.+.........+.....+.........+....+..+...+...+...+.+...+..+.+............+.....+...............+...+....+...........+..........+..............+....+.........+.....+......+.+......+........+..........+...............+..+.......+.....+...+...+..........+.....+......+...+...+.......+.....+.......+...+...+............+......+......+........+...+...+.........+.+......+......+.........+........+.+......+.....+...+......+.+..............+....+.....+...............+...+....+.........+............+..+......+.+......+...+.....+....+..+.+..+......+..........+.........+...+..+.+..+....+.........+......+......+...+..+..................+......+.+...+..+...............+..................+....+..+.+..+.+......+.........+.........+...+..+.+.........+..+...+............+.........+.+.....+................+...+.....+............+.......+........+....+......+........+....+.....+......+..........+......+...........+.........+....+..+...+....+...+..+...............+...+....+......+...+......+...+...........+......+......+....+......+........+.+.....+......+.......+.....+...+....+...+.....+......+.......+............+...+..............+...+.+.....+.+.....+.........+......+...............+.............+......+............+..+...+.......+...+...............+.....+.........+.+..+......+....+........+.........+.+.....+.............+......+......+........+.+.............................+....+.....+......+............+...+....+.....+.......+........+.......+...........+...+................+....................+................+...+.....+.......+..+...+.........+.........+.+.........+..+............+.+.....+.......+..+......+.......+..+......+......................+.........+...+..+...+.+.........+.....+.+.....+......+.+..+.+..............+.+......+.....+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Certificate request self-signature ok
subject=CN = redis-client
Изменение прав на сертификаты Redis...
Запуск Docker Compose...
Запуск тестового скрипта для PostgreSQL...
Копирование сертификатов в контейнер PostgreSQL...
Successfully copied 3.07kB to postgres:/etc/ssl/certs/ca-postgresql.crt
Successfully copied 2.56kB to postgres:/etc/ssl/certs/postgresql-server.crt
Successfully copied 3.58kB to postgres:/etc/ssl/certs/postgresql-server.key
Установка правильных прав на ключи...
total 28
drwxr-xr-x 1 root     root     4096 Oct 25 06:18 .
drwxr-xr-x 1 root     root     4096 Oct 17 01:25 ..
-rw------- 1 postgres postgres 1123 Oct 25 06:18 ca-postgresql.crt
lrwxrwxrwx 1 root     root       21 Oct 17 01:25 ce275665.0 -> ssl-cert-snakeoil.pem
-rw-r--r-- 1 postgres postgres 1005 Oct 25 06:18 postgresql-server.crt
-rw------- 1 postgres postgres 1704 Oct 25 06:18 postgresql-server.key
-rw-r--r-- 1 root     root     1090 Oct 17 01:25 ssl-cert-snakeoil.pem
Включение SSL в конфигурации PostgreSQL...
Перезапуск контейнера...
postgres
Проверка статуса SSL...
Проверка статуса SSL в PostgreSQL...
 ssl 
-----
 on
(1 row)


What's next?
  Try Docker Debug for seamless, persistent debugging tools in any container or image → docker debug postgres
  Learn more at https://docs.docker.com/go/debug-cli/
Скрипт завершён. Сертификаты обновлены, контейнер перезапущен и SSL включён.
```